when constructing the deploy.sh to deploy services and roles into azure make sure to Grant Directory Reader role to SQL Server identity and Assign Directory Reader role to SQL Server identity below is an
example of how that might look in the deploy.sh:

# Grant Directory Reader role to SQL Server identity

echo ""

echo "Step 2b: Granting Directory Reader role to SQL Server identity..."

DIRECTORY_READER_ROLE_ID=$(az rest --method GET --uri "https://graph.microsoft.com/v1.0/directoryRoles?\$filter=roleTemplateId eq '88d8e3e3-8f55-4a1e-953a-9b9898b8876b'" --headers "Content-Type=application/json" --query "value[0].id" -o tsv 2>/dev/null || true)
 
if [ -z "$DIRECTORY_READER_ROLE_ID" ]; then

    echo "  Activating Directory Reader role..."

    DIRECTORY_READER_ROLE_ID=$(az rest --method POST --uri "https://graph.microsoft.com/v1.0/directoryRoles" --headers "Content-Type=application/json" --body "{\"roleTemplateId\": \"88d8e3e3-8f55-4a1e-953a-9b9898b8876b\"}" --query "id" -o tsv)

fi
 
echo "  Assigning Directory Reader role to SQL Server identity..."

az rest --method POST \

    --uri "https://graph.microsoft.com/v1.0/directoryRoles/${DIRECTORY_READER_ROLE_ID}/members/\$ref" \

    --headers "Content-Type=application/json" \

    --body "{\"@odata.id\": \"https://graph.microsoft.com/v1.0/directoryObjects/${SQL_SERVER_IDENTITY_PRINCIPAL_ID}\"}" 2>/dev/null || echo "  Role may already be assigned"
 
echo "âœ“ Directory Reader role granted to SQL Server identity"

=-=-=-=-=-=

heres some more advice for this step:

I need to add a step to my bash deployment script that grants the Directory Reader role 
to an Azure SQL Server's system-assigned managed identity using the Microsoft Graph API.
 
The SQL Server's identity principal ID is stored in the variable: $SQL_SERVER_IDENTITY_PRINCIPAL_ID
 
Requirements:
1. First, try to get the Directory Reader role ID using a GET request to Microsoft Graph
2. If the role doesn't exist (empty response), activate it with a POST request
3. Then assign the SQL Server identity to that role using another POST request
4. Include error handling - suppress errors and show a message if the role is already assigned
5. Add appropriate echo statements to show progress
6. This should be Step 2b in the deployment process
 
The Directory Reader role template ID in Azure is: 88d8e3e3-8f55-4a1e-953a-9b9898b8876b
 
Use 'az rest' commands with the Microsoft Graph API v1.0 endpoint.
